<!DOCTYPE html>
<html lang="en">
	<meta charset="utf-8">
	<head>
		    <title>Read Text File</title>
		    <script src="../js/abcjs-basic-min.js" type="text/javascript"></script>
	</head>
	  
	<body>
		<input type="file" name="inputfile" id="inputfile" accept=".abc"> <br>
			   
		<pre id="output"></pre>
		<p>Tune string follows.</p>
		<pre id="properties"></pre>
		<pre id="tunestring"></pre>
		<pre id="ts2"></pre>
		<div id="contents"><h1>Contents</h1><p></p></div>
		<div id="titles"><h1>Title Index</h1><p></p></div>
			          
		<script type="text/javascript">
			document.getElementById('inputfile')
            	.addEventListener('change', function() {
		                  
		    var fr=new FileReader(), tb=null;
		    fr.onload=function(){
				var t = 2;
				var x = document.getElementById('output');
				var px = x.parentNode; // container for the Tune divs
				var cz = document.getElementById('contents').lastChild;
				var tz = document.getElementById('titles').lastChild;
				tb = new ABCJS.TuneBook(fr.result);
				// document.getElementById('output').textContent='No. tunes= '+tb.tunes.length;
				// document.getElementById('properties').textContent="properties = "+Object.getOwnPropertyNames(tb.tunes[t]).toString();
				// document.getElementById('tunestring').textContent=tb.tunes[t].title+'\n\n.pure='+tb.tunes[t].pure+'\n'+'startPos = '+tb.tunes[t].startPos;
				// document.getElementById('ts2').textContent=tb.tunes[t].title+'\n\n.abc='+tb.tunes[t].abc;
				// document.getElementById('tunestring').textContent=tb.tunes[1].abc;
				// ABCJS.renderAbc("T0", tb.tunes[t].abc);

				var clatt, xline;
				tb.tunes.forEach(function(tx, i, x) {
					// build Contents
					// console.log(tx.id+' '+tx.title);
					idstr = 'X_'+tx.id; // id string for this tune
					cz.appendChild(document.createTextNode(tx.id+' '));
					a = document.createElement('a');
					a.innerText = tx.title;
					a.setAttribute("href", '#'+idstr);
					cz.appendChild(a)
					cz.appendChild(document.createElement('br'));
					lines = tx.abc.split('\n')
					titles = lines.filter(function(x){return x.startsWith('T:')}).map(function(x){return x.slice(2).trim()});
					// console.log("titles = "+titles.toString())
					n = document.createElement("div");
					// clatt = document.createAttribute("id"); // create a id attribute
					// clatt.value = idstr;
					// n.setAttributeNode(clatt);
					n.setAttribute("id", idstr);
					px.append(n); // insert the <div=idstr> node
					ABCJS.renderAbc(idstr, tx.pure); // render the tune
				});
				// document.getElementById('output').textContent=fr.result;
			}
		                  
		    fr.readAsText(this.files[0]);
		    })
    	</script>
	</body>
	  
</html>
